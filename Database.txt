CREATE DATABASE IF NOT EXISTS cyber_securitydb;
USE cyber_securitydb;
-- 1. Users Table (User Management)
CREATE TABLE IF NOT EXISTS users (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(50) NOT NULL UNIQUE,
    password VARCHAR(255) NOT NULL,
    email VARCHAR(100) NOT NULL UNIQUE,
    role ENUM('ADMIN', 'ANALYST', 'VIEWER') NOT NULL DEFAULT 'VIEWER',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- 2. Assets Table (Asset Management)
CREATE TABLE IF NOT EXISTS assets (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    asset_name VARCHAR(255) NOT NULL,
    asset_type ENUM('SERVER', 'WORKSTATION', 'NETWORK_DEVICE', 'DATABASE') NOT NULL,
    ip_address VARCHAR(45),
    description TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- 3. Incidents Table (Incident Management)
CREATE TABLE IF NOT EXISTS incidents (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    title VARCHAR(255) NOT NULL,
    description TEXT NOT NULL,
    severity ENUM('LOW', 'MEDIUM', 'HIGH', 'CRITICAL') NOT NULL DEFAULT 'LOW',
    status ENUM('OPEN', 'IN_PROGRESS', 'RESOLVED', 'CLOSED') DEFAULT 'OPEN',
    reported_by BIGINT,
    assigned_to BIGINT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (reported_by) REFERENCES users(id),
    FOREIGN KEY (assigned_to) REFERENCES users(id)
);

-- 4. Vulnerabilities Table (Vulnerability Management)
CREATE TABLE IF NOT EXISTS vulnerabilities (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    title VARCHAR(255) NOT NULL,
    description TEXT NOT NULL,
    severity ENUM('LOW', 'MEDIUM', 'HIGH', 'CRITICAL') NOT NULL DEFAULT 'LOW',
    status ENUM('OPEN', 'IN_PROGRESS', 'PATCHED', 'RESOLVED') DEFAULT 'OPEN',
    affected_asset_id BIGINT,
    reported_by BIGINT,
    assigned_to BIGINT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (affected_asset_id) REFERENCES assets(id),
    FOREIGN KEY (reported_by) REFERENCES users(id),
    FOREIGN KEY (assigned_to) REFERENCES users(id)
);

-- 5. Incident Comments Table
CREATE TABLE IF NOT EXISTS incident_comments (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    incident_id BIGINT NOT NULL,
    user_id BIGINT NOT NULL,
    comment TEXT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (incident_id) REFERENCES incidents(id),
    FOREIGN KEY (user_id) REFERENCES users(id)
);

-- 6. Vulnerability Comments Table
CREATE TABLE IF NOT EXISTS vulnerability_comments (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    vulnerability_id BIGINT NOT NULL,
    user_id BIGINT NOT NULL,
    comment TEXT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (vulnerability_id) REFERENCES vulnerabilities(id),
    FOREIGN KEY (user_id) REFERENCES users(id)
);

-- 7. Alerts Table (Alert System)
CREATE TABLE IF NOT EXISTS alerts (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    alert_type ENUM('INCIDENT', 'VULNERABILITY') NOT NULL,
    reference_id BIGINT NOT NULL,
    description TEXT NOT NULL,
    severity ENUM('LOW', 'MEDIUM', 'HIGH', 'CRITICAL') NOT NULL,
    status ENUM('UNREAD', 'READ', 'RESOLVED') DEFAULT 'UNREAD',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Indexes for Users
CREATE INDEX idx_users_username ON users(username);
CREATE INDEX idx_users_email ON users(email);

-- Indexes for Incidents
CREATE INDEX idx_incidents_severity ON incidents(severity);
CREATE INDEX idx_incidents_status ON incidents(status);
CREATE INDEX idx_incidents_reported_by ON incidents(reported_by);

-- Indexes for Vulnerabilities
CREATE INDEX idx_vulnerabilities_severity ON vulnerabilities(severity);
CREATE INDEX idx_vulnerabilities_status ON vulnerabilities(status);
CREATE INDEX idx_vulnerabilities_affected_asset ON vulnerabilities(affected_asset_id);

-- Indexes for Alerts
CREATE INDEX idx_alerts_severity ON alerts(severity);
CREATE INDEX idx_alerts_status ON alerts(status);

-- Sample User (Password is hashed; use BCrypt in app, but plain here for demo)
INSERT INTO users (username, password, email, role) 
VALUES ('admin', '$2a$10$K.RB/3j2b4z5J3z5J3z5J.T3z5J3z5J3z5J3z5J3z5J3z5J3z5J', 'admin@cyber.com', 'ADMIN');

-- Sample Asset
INSERT INTO assets (asset_name, asset_type, ip_address, description) 
VALUES ('Main Server', 'SERVER', '192.168.1.100', 'Primary web server for the system');

-- Sample Incident (reported_by and assigned_to reference user ID 1)
INSERT INTO incidents (title, description, severity, status, reported_by, assigned_to) 
VALUES ('Phishing Attempt', 'Suspicious email received', 'HIGH', 'OPEN', 1, 1);

-- Sample Vulnerability (affected_asset_id references asset ID 1)
INSERT INTO vulnerabilities (title, description, severity, status, affected_asset_id, reported_by, assigned_to) 
VALUES ('SQL Injection Risk', 'Vulnerable query in login form', 'CRITICAL', 'OPEN', 1, 1, 1);

-- Sample Comment for Incident (incident_id 1, user_id 1)
INSERT INTO incident_comments (incident_id, user_id, comment) 
VALUES (1, 1, 'Investigating the source IP');

-- Sample Alert (for incident ID 1)
INSERT INTO alerts (alert_type, reference_id, description, severity, status) 
VALUES ('INCIDENT', 1, 'High severity incident detected', 'HIGH', 'UNREAD');
select * from users;
USE cyber_securitydb;
SELECT * FROM users;
DELETE FROM users;
UPDATE users SET role = 'ADMIN' WHERE username = 'admin1';
INSERT INTO users (username, password, email, role) VALUES 
('analyst1', '$2a$10$92IXUNpkjO0rOQ5byMi.Ye4oKoEa3Ro9llC/.og/at2.uheWG/igi', 'analyst@cyber.com', 'ANALYST');
INSERT INTO users (username, password, email, role) VALUES 
('viewer1', '$2a$10$92IXUNpkjO0rOQ5byMi.Ye4oKoEa3Ro9llC/.og/at2.uheWG/igi', 'viewer@cyber.com', 'VIEWER');
UPDATE users SET role = 'ANALYST' WHERE username = 'analyst';
UPDATE users SET role = 'VIEWER' WHERE username = 'viewer3';
SELECT username, email, role FROM users;
ALTER TABLE incidents 
MODIFY COLUMN description TEXT;
ALTER TABLE incidents 
MODIFY COLUMN resolution_notes TEXT;
select * from assets;
select * from incidents;
select * from vulnerabilities;